
{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile within the Gaia Loop application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "username": {
          "type": "string",
          "description": "User's chosen username."
        },
        "joinDate": {
          "type": "string",
          "description": "Date and time the user joined the platform.",
          "format": "date-time"
        },
        "ecoPoints": {
          "type": "number",
          "description": "Number of EcoPoints earned by the user."
        }
      },
      "required": [
        "id",
        "email",
        "username",
        "joinDate",
        "ecoPoints"
      ]
    },
    "WasteScan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WasteScan",
      "type": "object",
      "description": "Represents a waste material scan performed by the user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the WasteScan entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N WasteScan)"
        },
        "scanDate": {
          "type": "string",
          "description": "Date and time of the waste scan.",
          "format": "date-time"
        },
        "materialType": {
          "type": "string",
          "description": "Type of waste material identified (e.g., plastic, glass, paper)."
        },
        "disposalMethod": {
          "type": "string",
          "description": "Recommended disposal or reuse method."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the image used for the waste scan.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "userId",
        "scanDate",
        "materialType",
        "disposalMethod",
        "imageUrl"
      ]
    },
    "Reward": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Reward",
      "type": "object",
      "description": "Represents a reward that can be redeemed by users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Reward entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the reward."
        },
        "description": {
          "type": "string",
          "description": "Description of the reward."
        },
        "ecoPointsRequired": {
          "type": "number",
          "description": "Number of EcoPoints required to redeem the reward."
        },
        "provider": {
          "type": "string",
          "description": "Name of the reward provider (e.g., local business)."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "ecoPointsRequired",
        "provider"
      ]
    },
    "Redemption": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Redemption",
      "type": "object",
      "description": "Represents a reward redemption by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Redemption entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Redemption)"
        },
        "rewardId": {
          "type": "string",
          "description": "Reference to Reward. (Relationship: Reward 1:N Redemption)"
        },
        "redemptionDate": {
          "type": "string",
          "description": "Date and time of the reward redemption.",
          "format": "date-time"
        },
        "ecoPointsSpent": {
          "type": "number",
          "description": "Number of EcoPoints spent on the redemption."
        }
      },
      "required": [
        "id",
        "userId",
        "rewardId",
        "redemptionDate",
        "ecoPointsSpent"
      ]
    },
    "Listing": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Listing",
      "type": "object",
      "description": "Represents a waste material listing on the Waste-to-Value Marketplace.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Listing entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Listing)"
        },
        "title": {
          "type": "string",
          "description": "Title of the listing."
        },
        "description": {
          "type": "string",
          "description": "Description of the waste material."
        },
        "materialType": {
          "type": "string",
          "description": "Type of waste material listed."
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of waste material available."
        },
        "location": {
          "type": "string",
          "description": "Location of the waste material."
        },
        "contactInfo": {
          "type": "string",
          "description": "Contact information for the listing."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the image of the waste material.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "userId",
        "title",
        "description",
        "materialType",
        "quantity",
        "location",
        "contactInfo",
        "imageUrl"
      ]
    },
    "PolicyScenario": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PolicyScenario",
      "type": "object",
      "description": "Represents a policy scenario simulation from the AI Local Policy Advisor.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the PolicyScenario entity."
        },
        "userId": {
          "type": "string",
          "description": "ID of the user who ran the simulation."
        },
        "location": {
          "type": "string",
          "description": "The location for which the policy was simulated."
        },
        "policyDescription": {
          "type": "string",
          "description": "The user-provided description of the policy."
        },
        "simulationDate": {
          "type": "string",
          "format": "date-time",
          "description": "Date and time of the simulation."
        },
        "environmentalImpact": {
          "type": "object",
          "description": "Simulated environmental impact metrics.",
          "properties": {
            "metric": { "type": "string", "description": "e.g., 'CO2 Emissions Reduced'" },
            "value": { "type": "string", "description": "e.g., '15,000 tonnes/year'" },
            "impact": { "type": "string", "enum": ["positive", "negative"], "description": "Direction of the impact."}
          }
        },
        "alternativePolicies": {
          "type": "array",
          "description": "AI-suggested alternative or complementary policies.",
          "items": {
            "type": "object",
            "properties": {
              "title": { "type": "string" },
              "description": { "type": "string" }
            }
          }
        },
        "actionPlan": {
          "type": "array",
          "description": "A step-by-step action plan for implementation.",
          "items": {
            "type": "object",
            "properties": {
              "step": { "type": "number" },
              "title": { "type": "string" },
              "description": { "type": "string" },
              "timeline": { "type": "string" },
              "estimatedCost": { "type": "string" },
              "expectedBenefit": { "type": "string" }
            }
          }
        }
      },
      "required": [
        "id",
        "userId",
        "location",
        "policyDescription",
        "simulationDate"
      ]
    },
    "Article": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Article",
      "type": "object",
      "description": "Represents an educational article in the Environmental Education Hub.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Article entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the article."
        },
        "content": {
          "type": "string",
          "description": "Content of the article (HTML or Markdown)."
        },
        "publishDate": {
          "type": "string",
          "description": "Date and time the article was published.",
          "format": "date-time"
        },
        "topic": {
          "type": "string",
          "description": "Topic of the article (e.g., recycling, composting)."
        },
        "author": {
          "type": "string",
          "description": "Author of the article."
        }
      },
      "required": [
        "id",
        "title",
        "content",
        "publishDate",
        "topic",
        "author"
      ]
    },
    "Device": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Device",
      "type": "object",
      "description": "Represents a smart waste management device connected by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "The unique physical ID of the device."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who owns this device."
        },
        "name": {
          "type": "string",
          "description": "A user-friendly name for the device."
        },
        "location": {
          "type": "string",
          "description": "The physical location of the device."
        },
        "fillLevel": {
          "type": "number",
          "description": "The current fill level of the device as a percentage (0-100)."
        },
        "status": {
          "type": "string",
          "description": "The current status of the device.",
          "enum": ["online", "offline"]
        },
        "notificationTarget": {
          "type": "string",
          "description": "The target for notifications when the bin is full.",
          "enum": ["user", "nagarpalika"]
        },
        "lastUpdated": {
            "type": "string",
            "format": "date-time",
            "description": "The timestamp of the last data update from the device."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "location",
        "fillLevel",
        "status",
        "notificationTarget",
        "lastUpdated"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Accessible only by the user or admin. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/devices/{deviceId}",
        "definition": {
          "entityName": "Device",
          "schema": {
            "$ref": "#/backend/entities/Device"
          },
          "description": "Stores smart device records for each user. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "deviceId",
              "description": "The unique identifier of the device."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/wasteScans/{wasteScanId}",
        "definition": {
          "entityName": "WasteScan",
          "schema": {
            "$ref": "#/backend/entities/WasteScan"
          },
          "description": "Stores waste scan records for each user. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "wasteScanId",
              "description": "The unique identifier of the waste scan."
            }
          ]
        }
      },
      {
        "path": "/rewards/{rewardId}",
        "definition": {
          "entityName": "Reward",
          "schema": {
            "$ref": "#/backend/entities/Reward"
          },
          "description": "Stores reward information. Publicly accessible.",
          "params": [
            {
              "name": "rewardId",
              "description": "The unique identifier of the reward."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/redemptions/{redemptionId}",
        "definition": {
          "entityName": "Redemption",
          "schema": {
            "$ref": "#/backend/entities/Redemption"
          },
          "description": "Stores reward redemption records for each user. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "redemptionId",
              "description": "The unique identifier of the redemption."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/listings/{listingId}",
        "definition": {
          "entityName": "Listing",
          "schema": {
            "$ref": "#/backend/entities/Listing"
          },
          "description": "Stores waste material listings created by users. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "listingId",
              "description": "The unique identifier of the listing."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/policyScenarios/{policyScenarioId}",
        "definition": {
          "entityName": "PolicyScenario",
          "schema": {
            "$ref": "#/backend/entities/PolicyScenario"
          },
          "description": "Stores policy scenario simulations created by a user.",
          "params": [
             {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "policyScenarioId",
              "description": "The unique identifier of the policy scenario."
            }
          ]
        }
      },
      {
        "path": "/articles/{articleId}",
        "definition": {
          "entityName": "Article",
          "schema": {
            "$ref": "#/backend/entities/Article"
          },
          "description": "Stores environmental education articles. Publicly accessible.",
          "params": [
            {
              "name": "articleId",
              "description": "The unique identifier of the article."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and debuggability, adhering to the principles of Authorization Independence and Structural Segregation. User profiles and their associated data (waste scans, listings, redemptions, devices) are stored under their respective user IDs to maintain clear ownership. Publicly accessible data, such as rewards and articles, are stored in separate collections. This structure allows for simple and robust security rules.\n\nSpecifically, authorization independence is achieved by avoiding `get()` calls in security rules. The structure will leverage path-based ownership and appropriate denormalization if collaboration features are to be added in the future, such as the waste-to-value marketplace. For instance, the 'listings' collection, while owned by a user, could, in the future, require denormalizing user-specific roles or permissions within each document to handle collaborative access without relying on `get()` calls. Currently, only the user owning the listing has access, and this information is encoded via the path.\n\nQAPs (Rules are not Filters) are supported using segregation and path-based ownership. Private user data is segregated under `/users/{userId}`, enabling simple rules based on `request.auth.uid == userId`. Publicly accessible data such as `/articles` and `/rewards` can have list access rules that do not inadvertently expose other data. Denormalization of group membership data would also support QAPs if a collaborative feature, such as allowing multiple users to manage a single listing, were to be implemented."
  }
}
